{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap 0051ccefef5a85f5aa9c","webpack:///./src/logger.js","webpack:///./src/math.js","webpack:///external \"aws-sdk\"","webpack:///./src/index.js","webpack:///external \"@google-cloud/logging\"","webpack:///external \"pmx\"","webpack:///./src/ncryp.js","webpack:///external \"blind\"","webpack:///./src/handlerResponse.js","webpack:///./src/auth/index.js","webpack:///./src/redis.js","webpack:///external \"redis\"","webpack:///external \"jsonwebtoken\"","webpack:///./src/calculations.js","webpack:///external \"mathjs\"","webpack:///./src/sequence.js","webpack:///external \"async-lock\"","webpack:///./src/s3.js","webpack:///external \"multer\"","webpack:///external \"multer-s3\"","webpack:///external \"crypto\"","webpack:///./src/combinedMiddleware.js","webpack:///external \"connect\"","webpack:///./src/email.js","webpack:///external \"@sendgrid/mail\"","webpack:///./src/handlerBug.js","webpack:///external \"@bugsnag/js\"","webpack:///external \"@bugsnag/plugin-express\""],"names":["metadata","log","localLog","type","msg","plainMsg","JSON","stringify","console","info","debug","warn","error","write","notify","process","env","NODE_ENV","entry","err","apiResponse","Logger","config","logging","projectId","logName","Math","num","round","Ncryp","HandlerResponse","auth","Calculations","Sequence","S3","combinedMiddleware","Email","handlerBug","encryptKey","key","value","encrypted","encrypt","encryptedValue","decrypted","decrypt","response","status","json","code","message","serverTokenAuthenticated","req","token","headers","authorization","split","query","hasOwnProperty","body","secret","redis","apiKey","Auth","res","next","Error","sendStatus","verify","decoded","get","user","email","then","catch","reason","roles","decode","del","rembemberMe","expireTime","sign","expiresIn","set","toLowerCase","port","host","credential","Redis","client","createClient","retry_strategy","options","total_retry_time","attempt","undefined","min","on","expiration","Promise","resolve","reject","reply","expire","product","due","cardFee","processingFees","cardFeeFlat","paidUpFee","collectionFees","fee","paidUpFeeFlat","feeFlat","price","amount","processing","payFees","collect","result","paidupFee","priceBase","achFeeCap","achFee","achFeeFlat","lock","lambda","params","region","apiVersion","Lambda","qty","opt","FunctionName","functionName","InvocationType","LogType","Payload","db","acquire","done","invoke","data","parse","ret","randomValueBase64","len","randomBytes","ceil","toString","slice","replace","accessKeyId","secretAccessKey","bucket","directory","setOriginalName","isPublic","multer","storage","s3","acl","file","cb","fieldName","fieldname","dir","name","originalname","arrayMethods","chain","forEach","middleware","use","fromName","fromEmail","setApiKey","setSubstitutionWrappers","to","templateId","substitutions","from","send","subject","html","attachments","bugsnagClient","intercept","contextualize","errorMsg","HandlerBug","projectRoot","notifyReleaseStages","getPlugin","requestHandler","errorHandler"],"mappings":"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","file":"library.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"pu-common\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"pu-common\"] = factory();\n\telse\n\t\troot[\"pu-common\"] = factory();\n})(typeof self !== 'undefined' ? self : this, function() {\nreturn \n\n\n// WEBPACK FOOTER //\n// webpack/universalModuleDefinition"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/lib/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 0051ccefef5a85f5aa9c","import Logging from '@google-cloud/logging'\nimport pmx from 'pmx'\n\nlet { metadata, log } = {}\n\nfunction localLog (type, msg) {\n  const plainMsg = JSON.stringify(msg)\n  if (type === 'info') {\n    console.info(plainMsg)\n  } else if (type === 'debug') {\n    console.debug(plainMsg)\n  } else if (type === 'warning') {\n    console.warn(plainMsg)\n  } else {\n    console.error(plainMsg)\n  }\n}\n\nfunction write (type, msg, notify) {\n  if (process.env.NODE_ENV === 'test') {\n    return\n  }\n  const entry = log.entry(metadata, msg)\n  if (notify) {\n    pmx.notify(msg)\n  }\n  log[type](entry, (err, apiResponse) => {\n    if (err) {\n      console.error('Error: ', err)\n      console.error(`${type}: `, JSON.stringify(msg))\n    }\n  })\n  if (process.env.NODE_ENV === 'local') {\n    localLog(type, msg)\n  }\n}\n\nexport default class Logger {\n  static setConfig (config) {\n    metadata = config.metadata\n    if (process.env.NODE_ENV !== 'test') {\n      const logging = new Logging({\n        projectId: config.projectId\n      })\n      log = logging.log(config.logName)\n    }\n  }\n\n  static info (msg) {\n    write('info', msg)\n  }\n\n  static critical (msg) {\n    write('critical', msg, true)\n  }\n\n  static debug (msg) {\n    write('debug', msg)\n  }\n\n  static emergency (msg) {\n    write('emergency', msg, true)\n  }\n\n  static error (msg) {\n    write('error', msg, true)\n  }\n\n  static notice (msg) {\n    write('notice', msg)\n  }\n\n  static warning (msg) {\n    write('warning', msg)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/logger.js","import mathjs from 'mathjs'\n\nexport default class Math {\n  static round (num) {\n    return mathjs.round(num, 2)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/math.js","module.exports = require(\"aws-sdk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"aws-sdk\"\n// module id = 2\n// module chunks = 0","import Logger from './logger'\nimport Ncryp from './ncryp'\nimport HandlerResponse from './handlerResponse'\nimport auth from './auth'\nimport Calculations from './calculations'\nimport Sequence from './sequence'\nimport S3 from './s3'\nimport combinedMiddleware from './combinedMiddleware'\nimport Math from './math'\nimport Email from './email'\nimport handlerBug from './handlerBug'\n\nexport {\n  Logger,\n  Ncryp,\n  HandlerResponse,\n  auth,\n  Calculations,\n  Sequence,\n  S3,\n  combinedMiddleware,\n  Math,\n  Email,\n  handlerBug\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"@google-cloud/logging\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@google-cloud/logging\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"pmx\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pmx\"\n// module id = 5\n// module chunks = 0","import Blind from 'blind'\n\nlet encryptKey\n\nexport default class Ncryp {\n  static setKey (key) {\n    encryptKey = key\n  }\n\n  static encryptField (value) {\n    let encrypted = new Blind({ encryptKey }).encrypt(value)\n    return encrypted\n  }\n\n  static decryptField (encryptedValue) {\n    var decrypted = new Blind({ encryptKey }).decrypt(encryptedValue)\n    return decrypted\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ncryp.js","module.exports = require(\"blind\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"blind\"\n// module id = 7\n// module chunks = 0","import Logger from './logger'\n\nexport default class HandlerResponse {\n  static send (response, msg) {\n    return response.status(200).json(msg)\n  }\n\n  static error (response, msg, code) {\n    if (process.env.NODE_ENV === 'local') {\n      console.log('ERROR: ' + JSON.stringify(msg))\n    }\n    const err = {code: code, message: msg}\n    Logger.error(err)\n    return response.status(code || 500).json(err)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/handlerResponse.js","// import config from '@/config/environment'\nimport Redis from '../redis'\nimport jwt from 'jsonwebtoken'\n\n/**\n * Attaches the user object to the request if authenticated\n * Otherwise returns 403\n */\n\nfunction serverTokenAuthenticated (req) {\n  let token\n  // allow access_token to be passed through query parameter as well\n  if (req.headers.authorization) {\n    token = req.headers.authorization.split(' ')[1]\n  } else if (req.query && req.query.hasOwnProperty('token')) {\n    token = req.query.token\n  } else if (req.body && req.body.token) {\n    token = req.body.token\n  } else if (req.query && req.query.hasOwnProperty('access_token')) {\n    token = req.query.token\n  }\n  return token\n}\n\nlet secret\nlet redis\nlet apiKey\n\nclass Auth {\n  set config ({ port, host, credential, key }) {\n    secret = credential\n    redis = new Redis(port, host)\n    apiKey = key\n  }\n\n  validate (req, res, next) {\n    if (!secret) {\n      throw new Error('first must set cretendials, use fn config')\n    }\n    if (!apiKey) {\n      throw new Error('first must set cretendials, use fn config')\n    }\n    if (req.headers['x-api-key']) {\n      if (req.headers['x-api-key'] === apiKey) {\n        return next()\n      }\n      return res.sendStatus(401)\n    }\n    const token = serverTokenAuthenticated(req)\n    if (!token) {\n      return res.sendStatus(401)\n    }\n    jwt.verify(token, secret, (error, decoded) => {\n      if (error) {\n        return res.status(401).json({error, message: 'invalid token'})\n      }\n      redis.get(decoded.user.email).then(value => {\n        if (token !== value) return res.sendStatus(401)\n        req.user = decoded.user\n        next()\n      }).catch(reason => {\n        res.sendStatus(500).json(reason)\n      })\n    })\n  }\n\n  populateUser (req, res, next) {\n    if (req.headers['x-api-key']) {\n      if (req.headers['x-api-key'] === apiKey) {\n        req.user = {roles: ['api']}\n        return next()\n      }\n      return res.sendStatus(401)\n    }\n    const token = serverTokenAuthenticated(req)\n    if (!token) {\n      req.user = {roles: ['']}\n      return next()\n    }\n    jwt.verify(token, secret, (error, decoded) => {\n      if (error) {\n        return res.status(401).json({error, message: 'invalid token'})\n      }\n      redis.get(decoded.user.email).then(value => {\n        if (token !== value) return res.sendStatus(401)\n        req.user = decoded.user\n        next()\n      }).catch(reason => {\n        res.sendStatus(500).json(reason)\n      })\n    })\n  }\n\n  revoke (req, res, next) {\n    if (!secret) {\n      throw new Error('first must set cretendials, use fn setCredential')\n    }\n    let token = serverTokenAuthenticated(req)\n    if (!token) {\n      return res.sendStatus(401)\n    }\n    const decoded = jwt.decode(token)\n    if (decoded) {\n      redis.del(decoded.user.email)\n    }\n    next()\n  }\n\n  token (user, rembemberMe) {\n    let expireTime = (60 * 60)\n    if (rembemberMe) {\n      expireTime = expireTime * 60\n    }\n    let token = jwt.sign({ user }, secret, {\n      expiresIn: expireTime\n    })\n    redis.set(user.email.toLowerCase(), token, expireTime)\n    return token\n  }\n\n  remove (email) {\n    return this.redis.del()\n  }\n}\n\nconst auth = new Auth()\n\nexport default auth\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth/index.js","import redis from 'redis'\n\nexport default class Redis {\n  constructor (port, host) {\n    this.client = redis.createClient({\n      port,\n      host,\n      retry_strategy: function (options) {\n        if (options.error && options.error.code === 'ECONNREFUSED') {\n          // End reconnecting on a specific error and flush all commands with\n          // a individual error\n          return new Error('The server refused the connection')\n        }\n        if (options.total_retry_time > 1000 * 60 * 60) {\n          // End reconnecting after a specific timeout and flush all commands\n          // with a individual error\n          return new Error('Retry time exhausted')\n        }\n        if (options.attempt > 10) {\n          // End reconnecting with built in error\n          return undefined\n        }\n        // reconnect after\n        return Math.min(options.attempt * 100, 3000)\n      }\n    })\n    this.client.on('connect', function () {\n    })\n  }\n\n  set (key, value, expiration = 86400) {\n    return new Promise((resolve, reject) => {\n      this.client.set(key, value, (err, reply) => {\n        if (err) {\n          return reject(err)\n        }\n        this.client.expire(key, expiration)\n        resolve(reply)\n      })\n    })\n  }\n\n  get (key) {\n    return new Promise((resolve, reject) => {\n      this.client.get(key, (err, reply) => {\n        if (err) {\n          return reject(err)\n        }\n        resolve(reply)\n      })\n    })\n  }\n\n  del (key) {\n    return new Promise((resolve, reject) => {\n      this.client.del(key, (err, reply) => {\n        if (err) {\n          return reject(err)\n        }\n        resolve(reply)\n      })\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/redis.js","module.exports = require(\"redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redis\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 12\n// module chunks = 0","import Math from './math'\n\nexport default class Calculations {\n  static card (product, due) {\n    const cardFee = product.processingFees.cardFee / 100\n    const cardFeeFlat = product.processingFees.cardFeeFlat\n    const paidUpFee = product.collectionFees.fee / 100\n    const paidUpFeeFlat = product.collectionFees.feeFlat\n    const price = due.amount\n    const processing = product.payFees.processing\n    const collect = product.payFees.collect\n\n    var result = {\n      paidupFee: 0,\n      priceBase: 0\n    }\n\n    if (!processing && collect) {\n      result.priceBase = Math.round((price - paidUpFeeFlat) / (1 + paidUpFee))\n    } else if (!processing && !collect) {\n      result.priceBase = Math.round(price)\n    } else if (processing && collect) {\n      result.priceBase = Math.round((price - price * cardFee - paidUpFeeFlat - cardFeeFlat) / (1 + paidUpFee))\n    } else if (processing && !collect) {\n      result.priceBase = Math.round(price - price * cardFee - cardFeeFlat)\n    }\n\n    result.paidupFee = Math.round(result.priceBase * paidUpFee + paidUpFeeFlat)\n\n    return result\n  }\n\n  static bank (product, due) {\n    const achFeeCap = product.processingFees.achFeeCap\n    const achFee = (product.processingFees.achFee / 100)\n    const achFeeFlat = product.processingFees.achFeeFlat\n    const paidUpFee = product.collectionFees.fee / 100\n    const paidUpFeeFlat = product.collectionFees.feeFlat\n    const price = due.amount\n    const collect = product.payFees.collect\n    const processing = product.payFees.processing\n\n    var result = {\n      priceBase: 0,\n      paidupFee: 0\n    }\n\n    if (!processing && collect) {\n      result.priceBase = Math.round((price - paidUpFeeFlat) / (1 + paidUpFee))\n    } else if (!processing && !collect) {\n      result.priceBase = Math.round(price)\n    } else if (processing && collect) {\n      if (price <= (achFeeCap / achFee)) {\n        result.priceBase = Math.round((price - price * achFee - paidUpFeeFlat - achFeeFlat) / (1 + paidUpFee))\n      } else {\n        result.priceBase = Math.round((price - achFeeCap - paidUpFeeFlat) / (1 + paidUpFee))\n      }\n    } else if (processing && !collect) {\n      if (price <= (achFeeCap / achFee)) {\n        result.priceBase = Math.round(price - price * achFee - achFeeFlat)\n      } else {\n        result.priceBase = Math.round(price - achFeeCap - achFeeFlat)\n      }\n    }\n\n    result.paidupFee = Math.round(result.priceBase * paidUpFee + paidUpFeeFlat)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/calculations.js","module.exports = require(\"mathjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mathjs\"\n// module id = 14\n// module chunks = 0","import AWS from 'aws-sdk'\nimport AsyncLock from 'async-lock'\nconst lock = new AsyncLock()\nlet lambda\nlet options\n\nexport default class Sequence {\n  static setConfig (params, region = 'us-east-1', apiVersion = '2015-03-31') {\n    options = params\n    lambda = new AWS.Lambda({region, apiVersion})\n  }\n\n  static next (key, qty = 1) {\n    let opt = {\n      FunctionName: options.functionName,\n      InvocationType: 'RequestResponse',\n      LogType: 'None',\n      Payload: JSON.stringify({\n        key,\n        db: options.db,\n        host: options.host,\n        port: options.port,\n        qty\n      })\n    }\n    return new Promise((resolve, reject) => {\n      lock.acquire(key, function (done) {\n        lambda.invoke(opt, function (error, data) {\n          if (error) return done(error)\n          done(null, JSON.parse(data.Payload))\n        })\n      }, function (err, ret) {\n        if (err) {\n          reject(err)\n        } else {\n          resolve(ret)\n        }\n      })\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/sequence.js","module.exports = require(\"async-lock\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"async-lock\"\n// module id = 16\n// module chunks = 0","import aws from 'aws-sdk'\nimport multer from 'multer'\nimport multerS3 from 'multer-s3'\nimport crypto from 'crypto'\n\nfunction randomValueBase64 (len = 4) {\n  return crypto.randomBytes(Math.ceil(len * 3 / 4))\n    .toString('base64') // convert to base64 format\n    .slice(0, len) // return required number of characters\n    .replace(/\\+/g, '0') // replace '+' with '0'\n    .replace(/\\//g, '0') // replace '/' with '0'\n}\n\nexport default class S3 {\n  constructor ({ accessKeyId, secretAccessKey, region = 'us-east-1', bucket, directory, setOriginalName, isPublic } = {}) {\n    this.multer = multer({\n      storage: multerS3({\n        s3: new aws.S3({ accessKeyId, secretAccessKey, region }),\n        bucket,\n        acl: isPublic ? 'public-read' : 'private',\n        metadata: function (req, file, cb) {\n          cb(null, {fieldName: file.fieldname})\n        },\n        key: function (req, file, cb) {\n          const dir = directory ? directory + '/' : ''\n          const name = setOriginalName ? file.originalname : `${randomValueBase64()}_${randomValueBase64()}_${randomValueBase64()}_${randomValueBase64()}`\n          cb(null, dir + name)\n        }\n      })\n    })\n  }\n\n  get upload () {\n    return this.multer\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/s3.js","module.exports = require(\"multer\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer\"\n// module id = 18\n// module chunks = 0","module.exports = require(\"multer-s3\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"multer-s3\"\n// module id = 19\n// module chunks = 0","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 20\n// module chunks = 0","import connect from 'connect'\n\nexport default function combinedMiddleware (arrayMethods) {\n  return (function () {\n    var chain = connect()\n    arrayMethods.forEach(function (middleware) {\n      chain.use(middleware)\n    })\n    return chain\n  })()\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/combinedMiddleware.js","module.exports = require(\"connect\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"connect\"\n// module id = 22\n// module chunks = 0","import sgMail from '@sendgrid/mail'\n\nexport default class Email {\n  constructor ({apiKey, fromName, fromEmail}) {\n    this.fromName = fromName\n    this.fromEmail = fromEmail\n    sgMail.setApiKey(apiKey)\n    sgMail.setSubstitutionWrappers('{{', '}}')\n  }\n\n  sendTemplate (to, templateId, substitutions) {\n    const msg = {\n      to,\n      from: {\n        name: this.fromName,\n        email: this.fromEmail\n      },\n      templateId,\n      substitutions\n    }\n    sgMail.send(msg)\n  }\n\n  sendEmail (to, subject, html, attachments) {\n    const msg = {\n      to,\n      from: {\n        name: this.fromName,\n        email: this.fromEmail\n      },\n      subject,\n      html\n    }\n    if (attachments) msg.attachments = attachments\n    return sgMail.send(msg)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/email.js","module.exports = require(\"@sendgrid/mail\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@sendgrid/mail\"\n// module id = 24\n// module chunks = 0","import bugsnag from '@bugsnag/js'\nimport bugsnagExpress from '@bugsnag/plugin-express'\n\nlet bugsnagClient, middleware, intercept, contextualize\nconst errorMsg = 'Class not initialized, execute init ({apiKey, projectRoot, notifyReleaseStages})'\n\nclass HandlerBug {\n  init ({apiKey, projectRoot, notifyReleaseStages}) {\n    bugsnagClient = bugsnag({\n      apiKey, projectRoot, notifyReleaseStages\n    })\n    bugsnagClient.use(bugsnagExpress)\n    middleware = bugsnagClient.getPlugin('express')\n    intercept = bugsnagClient.getPlugin('intercept')\n    contextualize = bugsnagClient.getPlugin('contextualize')\n  }\n\n  get requestHandler () {\n    if (!bugsnagClient) throw new Error(errorMsg)\n    return middleware.requestHandler\n  }\n\n  get errorHandler () {\n    if (!bugsnagClient) throw new Error(errorMsg)\n    return middleware.errorHandler\n  }\n\n  get intercept () {\n    if (!bugsnagClient) throw new Error(errorMsg)\n    return intercept\n  }\n\n  get contextualize () {\n    if (!bugsnagClient) throw new Error(errorMsg)\n    return contextualize\n  }\n\n  notify (error) {\n    if (!bugsnagClient) throw new Error(errorMsg)\n    bugsnagClient.notify(error)\n  }\n}\n\nexport default new HandlerBug()\n\n\n\n// WEBPACK FOOTER //\n// ./src/handlerBug.js","module.exports = require(\"@bugsnag/js\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@bugsnag/js\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"@bugsnag/plugin-express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@bugsnag/plugin-express\"\n// module id = 27\n// module chunks = 0"],"sourceRoot":""}