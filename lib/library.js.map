{"version":3,"sources":["webpack:///webpack/bootstrap 2f9e5e80c267731b522c","webpack:///./src/logger.js","webpack:///./src/index.js","webpack:///external \"@google-cloud/logging\"","webpack:///external \"pmx\"","webpack:///./src/ncryp.js","webpack:///external \"blind\"","webpack:///./src/handlerResponse.js","webpack:///./src/auth.js","webpack:///./src/redis.js","webpack:///external \"redis\"","webpack:///external \"jsonwebtoken\"","webpack:///./src/calculations.js","webpack:///./src/math.js","webpack:///external \"mathjs\""],"names":["metadata","log","localLog","type","msg","plainMsg","JSON","stringify","console","info","debug","warn","error","write","notify","process","env","NODE_ENV","entry","err","apiResponse","Logger","config","logger","logging","projectId","logName","Ncryp","HandlerResponse","auth","Calculations","conf","value","encrypted","encryptKey","encrypt","encryptedValue","decrypted","decrypt","response","status","json","code","resason","setCredential","revoke","validate","serverTokenAuthenticated","req","token","headers","authorization","split","query","hasOwnProperty","body","secret","credential","res","next","Error","sendStatus","decoded","decode","del","user","email","verify","message","get","then","catch","reason","Redis","client","createClient","redis","port","host","on","key","expiration","Promise","resolve","reject","set","reply","expire","product","due","cardFee","processingFees","cardFeeFlat","paidUpFee","collectionFees","fee","paidUpFeeFlat","feeFlat","price","amount","processing","payFees","collect","result","paidupFee","priceBase","round","achFeeCap","achFee","achFeeFlat","Math","num"],"mappings":"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","file":"library.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/lib/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2f9e5e80c267731b522c","import Logging from '@google-cloud/logging'\nimport pmx from 'pmx'\n\nlet { metadata, log } = {}\n\nfunction localLog (type, msg) {\n  const plainMsg = JSON.stringify(msg)\n  if (type === 'info') {\n    console.info(plainMsg)\n  } else if (type === 'debug') {\n    console.debug(plainMsg)\n  } else if (type === 'warning') {\n    console.warn(plainMsg)\n  } else {\n    console.error(plainMsg)\n  }\n}\n\nfunction write (type, msg, notify) {\n  if (process.env.NODE_ENV === 'test') {\n    return\n  }\n  const entry = log.entry(metadata, msg)\n  if (notify) {\n    pmx.notify(msg)\n  }\n  log[type](entry, (err, apiResponse) => {\n    if (err) {\n      console.error('Error: ', err)\n      console.error(`${type}: `, JSON.stringify(msg))\n    }\n  })\n  if (process.env.NODE_ENV === 'local') {\n    localLog(type, msg)\n  }\n}\n\nexport default class Logger {\n  set config (config) {\n    metadata = config.logger.metadata\n    if (process.env.NODE_ENV !== 'test') {\n      const logging = new Logging({\n        projectId: config.logger.projectId\n      })\n      log = logging.log(config.logger.logName)\n    }\n  }\n\n  static info (msg) {\n    write('info', msg)\n  }\n\n  static critical (msg) {\n    write('critical', msg, true)\n  }\n\n  static debug (msg) {\n    write('debug', msg)\n  }\n\n  static emergency (msg) {\n    write('emergency', msg, true)\n  }\n\n  static error (msg) {\n    write('error', msg, true)\n  }\n\n  static notice (msg) {\n    write('notice', msg)\n  }\n\n  static warning (msg) {\n    write('warning', msg)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/logger.js","import Logger from './logger'\nimport Ncryp from './ncryp'\nimport HandlerResponse from './handlerResponse'\nimport auth from './auth'\nimport Calculations from './calculations'\n\nexport {\n  Logger,\n  Ncryp,\n  HandlerResponse,\n  auth,\n  Calculations\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","module.exports = require(\"@google-cloud/logging\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@google-cloud/logging\"\n// module id = 2\n// module chunks = 0","module.exports = require(\"pmx\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"pmx\"\n// module id = 3\n// module chunks = 0","import Blind from 'blind'\n\nlet config\n\nexport default class {\n  set config (conf) {\n    config = conf\n  }\n\n  static encryptField (value) {\n    let encrypted = new Blind({ encryptKey: config.encryptKey }).encrypt(value)\n    return encrypted\n  }\n\n  static decryptField (encryptedValue) {\n    var decrypted = new Blind({ encryptKey: config.encryptKey }).decrypt(encryptedValue)\n    return decrypted\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/ncryp.js","module.exports = require(\"blind\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"blind\"\n// module id = 5\n// module chunks = 0","import Logger from './logger'\n\nexport default class HandlerResponse {\n  static send (response, msg) {\n    return this.response.status(200).json(msg)\n  }\n\n  static error (response, msg, code) {\n    Logger.error({code: code, resason: msg})\n    return this.response.status(code || 500).json(msg)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/handlerResponse.js","// import config from '@/config/environment'\nimport Redis from './redis'\nimport jwt from 'jsonwebtoken'\n\n/**\n * Attaches the user object to the request if authenticated\n * Otherwise returns 403\n */\n\nfunction serverTokenAuthenticated (req) {\n  let token\n  // allow access_token to be passed through query parameter as well\n  if (req.headers.authorization) {\n    token = req.headers.authorization.split(' ')[1]\n  } else if (req.query && req.query.hasOwnProperty('token')) {\n    token = req.query.token\n  } else if (req.body && req.body.token) {\n    token = req.body.token\n  } else if (req.query && req.query.hasOwnProperty('access_token')) {\n    token = req.query.token\n  }\n  return token\n}\n\nlet secret\n\nexport function setCredential (credential) {\n  secret = credential\n}\n\nexport function revoke (req, res, next) {\n  if (!secret) {\n    throw new Error('first must set cretendials, use fn setCredential')\n  }\n  let token = serverTokenAuthenticated(req)\n  if (!token) {\n    return res.sendStatus(401)\n  }\n  const decoded = jwt.decode(token)\n  if (decoded) {\n    Redis.del(decoded.user.email)\n  }\n  next()\n}\n\nexport function validate (req, res, next) {\n  if (!secret) {\n    throw new Error('first must set cretendials, use fn setCredential')\n  }\n  let token = serverTokenAuthenticated(req)\n  if (!token) {\n    return res.sendStatus(401)\n  }\n  jwt.verify(token, secret, (error, decoded) => {\n    if (error) {\n      return res.status(500).json({error, message: 'invalid token'})\n    }\n    Redis.get(decoded.user.email).then(value => {\n      if (token !== value) return res.sendStatus(401)\n      req.user = decoded.user\n      next()\n    }).catch(reason => {\n      res.sendStatus(500).json(reason)\n    })\n  })\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/auth.js","import redis from 'redis'\nimport Logger from './logger'\n\nexport default class Redis {\n  constructor (config) {\n    this.client = redis.createClient(config.redis.port, config.redis.host)\n    this.client.on('connect', function () {\n      Logger.info('connected to redis')\n    })\n  }\n\n  set (key, value, expiration = 86400) {\n    return new Promise((resolve, reject) => {\n      this.client.set(key, value, (err, reply) => {\n        if (err) {\n          reject(err)\n        }\n        this.client.expire(key, expiration)\n        resolve(reply)\n      })\n    })\n  }\n\n  get (key) {\n    return new Promise((resolve, reject) => {\n      this.client.get(key, (err, reply) => {\n        if (err) {\n          reject(err)\n        }\n        resolve(reply)\n      })\n    })\n  }\n\n  del (key) {\n    return new Promise((resolve, reject) => {\n      this.client.del(key, (err, reply) => {\n        if (err) {\n          reject(err)\n        }\n        resolve(reply)\n      })\n    })\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/redis.js","module.exports = require(\"redis\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"redis\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 10\n// module chunks = 0","import Math from './math'\n\nexport default class Calculations {\n  static card (product, due) {\n    const cardFee = product.processingFees.cardFee / 100\n    const cardFeeFlat = product.processingFees.cardFeeFlat\n    const paidUpFee = product.collectionFees.fee / 100\n    const paidUpFeeFlat = product.collectionFees.feeFlat\n    const price = due.amount\n    const processing = product.payFees.processing\n    const collect = product.payFees.collect\n\n    var result = {\n      paidupFee: 0,\n      priceBase: 0\n    }\n\n    if (!processing && collect) {\n      result.priceBase = Math.round((price - paidUpFeeFlat) / (1 + paidUpFee))\n    } else if (!processing && !collect) {\n      result.priceBase = Math.round(price)\n    } else if (processing && collect) {\n      result.priceBase = Math.round((price - price * cardFee - paidUpFeeFlat - cardFeeFlat) / (1 + paidUpFee))\n    } else if (processing && !collect) {\n      result.priceBase = Math.round(price - price * cardFee - cardFeeFlat)\n    }\n\n    result.paidupFee = Math.round(result.priceBase * paidUpFee + paidUpFeeFlat)\n\n    return result\n  }\n\n  static bank (product, due) {\n    const achFeeCap = product.processingFees.achFeeCap\n    const achFee = (product.processingFees.achFee / 100)\n    const achFeeFlat = product.processingFees.achFeeFlat\n    const paidUpFee = product.collectionFees.fee / 100\n    const paidUpFeeFlat = product.collectionFees.feeFlat\n    const price = due.amount\n    const collect = product.payFees.collect\n    const processing = product.payFees.processing\n\n    var result = {\n      priceBase: 0,\n      paidupFee: 0\n    }\n\n    if (!processing && collect) {\n      result.priceBase = Math.round((price - paidUpFeeFlat) / (1 + paidUpFee))\n    } else if (!processing && !collect) {\n      result.priceBase = Math.round(price)\n    } else if (processing && collect) {\n      if (price <= (achFeeCap / achFee)) {\n        result.priceBase = Math.round((price - price * achFee - paidUpFeeFlat - achFeeFlat) / (1 + paidUpFee))\n      } else {\n        result.priceBase = Math.round((price - achFeeCap - paidUpFeeFlat) / (1 + paidUpFee))\n      }\n    } else if (processing && !collect) {\n      if (price <= (achFeeCap / achFee)) {\n        result.priceBase = Math.round(price - price * achFee - achFeeFlat)\n      } else {\n        result.priceBase = Math.round(price - achFeeCap - achFeeFlat)\n      }\n    }\n\n    result.paidupFee = Math.round(result.priceBase * paidUpFee + paidUpFeeFlat)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/calculations.js","import mathjs from 'mathjs'\n\nexport default class Math {\n  static round (num) {\n    return mathjs.round(num, 2)\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/math.js","module.exports = require(\"mathjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mathjs\"\n// module id = 13\n// module chunks = 0"],"sourceRoot":""}